Bootstrap: docker
From: centos:7

# sudo apptainer build --force bag3++_centos7.sif bag3++_centos7.def
# apptainer shell -B /tools,/users,/run/media bag3++_centos7.sif

%setup
    #run on the host system after base image. Filepaths are relative to host.
    mkdir ${APPTAINER_ROOTFS}/users
    mkdir ${APPTAINER_ROOTFS}/tools

    #used to mount scratch disks
    mkdir ${APPTAINER_ROOTFS}/run/media

%post

    #-----Below elements are for Cadence and other proprietary EDA tools    

    # CentOS 7 image on dockerhub isnt updated, so run this first
    yum -y update && yum clean all
    
    #list of packages required by Cadence Virtusoso IC618
    yum install -y csh tcsh glibc elfutils-libelf ksh mesa-libGL mesa-libGLU motif libXp libpng libjpeg-turbo expat glibc-devel gdb xorg-x11-fonts-misc xorg-x11-fonts-ISO8859-1-75dpi redhat-lsb libXScrnSaver apr apr-util compat-db47 xorg-x11-server-Xvfb mesa-dri-drivers openssl-devel xterm
    
    #For IC617 and below, i686 package versions are required to support 32-bit binaries
    #yum install -y glibc.i686 elfutils-libelf.i686 mesa-libGL.i686 mesa-libGLU.i686 motif.i686 libXp.i686 libpng.i686 libjpeg-turbo.i686 expat.i686 glibc-devel.i686 redhat-lsb.i686

    # additional package required for X11 forwarding
    yum install -y xorg-x11-utils

    #-----below elements are for compiling BAG Dependencies

    # Extras repo needed to provide some packages below
    yum install -y centos-release-scl centos-release-scl-rh
    
    # rh-git29 isnt in official repos anymore, so use this instead
    yum install -y devtoolset-8 httpd24-curl httpd24-libcurl rh-git218
    
    # additional tools
    yum install -y curl make wget

    # needed for compiling
    yum install -y openssl-devel gcc gdb autoconf automake libtool
