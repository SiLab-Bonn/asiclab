Bootstrap: docker
From: centos:7

# To compile, on penelope:
# sudo apptainer build --force /mnt/md127/tools/containers/virtuoso_centos7.sif /mnt/md127/tools/asiclab-docs/container_def/virtuoso_centos7.def

# Then to run, on asiclab workstation:
# apptainer shell -B /tools,/users /tools/containers/virtuoso_centos7.sif
    
%setup
    # Run on the host system, after the base container OS is installed. Filepaths are relative to host (Fedora)
    mkdir ${APPTAINER_ROOTFS}/tools
    mkdir ${APPTAINER_ROOTFS}/users
    
%environment
    # Place for adding environment variables here, if needed

%post
    # Section to download and install packages before container is immutable
    
    # CentOS 7 image on dockerhub isn't updated, so run this first
    yum -y update && yum clean all
    
    # List of packages required by Cadence Virtusoso IC618
    yum install -y csh tcsh glibc elfutils-libelf ksh mesa-libGL mesa-libGLU motif libXp libpng libjpeg-turbo expat glibc-devel gdb redhat-lsb libXScrnSaver xorg-x11-fonts-misc xorg-x11-fonts-ISO8859-1-75dpi apr apr-util compat-db47 xorg-x11-server-Xvfb mesa-dri-drivers openssl-devel
    
    # Some additional fonts to resolve Virtuoso CIW complaining about fonts, but needed them on host Fedora machine instead
    # yum install -y xorg-x11-fonts-100dpi xorg-x11-fonts-75dpi xorg-x11-fonts-ISO8859-1-100dpi xorg-x11-fonts-ISO8859-1-75dpi xorg-x11-fonts-ISO8859-9-100dpi xorg-x11-fonts-ISO8859-9-75dpi xorg-x11-fonts-Type1 xorg-x11-fonts-misc

    # For IC617 and below, i686 package versions are required to support 32-bit binaries
    # yum install -y glibc.i686 elfutils-libelf.i686 mesa-libGL.i686 mesa-libGLU.i686 motif.i686 libXp.i686 libpng.i686 libjpeg-turbo.i686 expat.i686 glibc-devel.i686 redhat-lsb.i686  
    
    # For Spectre, at least this additional package is required
    yum install -y cpp
    
    # Additional packages required by Cliosoft SOS
    yum install -y libXpm
    
    # Additional package required for X11 forwarding
    yum install -y xorg-x11-utils

    # Additional misc
    yum install -y xterm
